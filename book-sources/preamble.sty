\usepackage{classicthesis}
\usepackage{imakeidx}
\makeindex[columns=2, title=Index]

% Get the chapter numbers at a good location.

\titleformat{\chapter}[display]%
  {\relax}{\vspace*{-3\baselineskip}\makebox[\linewidth][r]{\color{halfgray}\chapterNumber\thechapter}}{0pt}%
  {\raggedright\spacedallcaps}[\normalsize\vspace*{.8\baselineskip}\titlerule]%

\usepackage{natbib}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{mathtools,amsthm,amssymb,amsmath}
\usepackage{verbatim}
\usepackage{enumitem}
\usepackage{sidenotes}
\usepackage{ccicons}

\numberwithin{equation}{section}

\usepackage{fourier}
%\usepackage{tgschola}
\usepackage[T1]{fontenc} % necessary to print >>> correctly.

%\usepackage[a5paper,landscape]{geometry}
\usepackage{geometry}
\newgeometry{left=1.8cm,right=1.8cm,top=2.2cm,bottom=3cm,marginparsep=1.2cm,marginparwidth=4.5cm,includemp} %,showframe}
\savegeometry{tufte}
\newgeometry{left=3cm,right=3cm,bottom=3cm}
\savegeometry{normal}


\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{arrows,automata,positioning,arrows.meta}
\usetikzlibrary{decorations.markings}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{groupplots}

% I don't know why, pythontext should appear somewhere above some
% other packages. I don't know which ones, but at this spot it works.
\usepackage{pythontex}
\setpythontexfv[]{numbers=left, frame=lines, xleftmargin=5mm,framesep=2mm,fontsize=\footnotesize}
\setpythontexoutputdir{\detokenize{~/.pythontex/}}


\usepackage{subfiles}
% load subfiles before the comment package to avoid problems during compiliaton.
%\usepackage{comment}

\usepackage{etoc}


% Widen figure captions
\usepackage{caption}
\captionsetup{margin={0cm, -5cm},font={small, sl},labelfont=sc}
\captionsetup[figure]{name=Fig.}


\usepackage[capitalize]{cleveref}
\crefname{equation}{}{}
\crefname{figure}{Fig.}{Figs.}
\Crefname{figure}{Fig.}{Figs.}
\crefname{definition}{Def.}{Defs.}
\Crefname{definition}{Def.}{Defs.}
\crefname{theorem}{Th.}{Ths.}
\Crefname{theorem}{Th.}{Ths.}
\crefname{lemam}{Lem.}{Lems.}
\Crefname{lemma}{Lem.}{Lems.}
\crefname{corollary}{Cor.}{Cors.}
\crefformat{exercise}{[#2#1#3]}
\crefformat{truefalse}{[#2#1#3]}
\crefformat{extra}{[#2#1#3]}
\crefformat{marginexercise}{[#2#1#3]}
\crefrangeformat{exercise}{[#3#1#4] to~[#5#2#6]}
\crefmultiformat{exercise}{[#2#1#3]}{ and~[#2#1#3]}{, [#2#1#3]}{ and~]#2#1#3]}


\usepackage{xr} % external document
% \usepackage{refcheck} % does not work nicely with cleveref.
% \usepackage{showlabels}  % check on all labels and references, similar to refcheck.

%\usepackage[cachedir=\detokenize{~/.mintedcache}]{minted}
\usepackage[cachedir=/home/nicky/.mintedcache]{minted}
\setminted[python]{numbers=left,frame=lines,fontsize=\footnotesize,xleftmargin=5mm,framesep=2mm,python3=true}
\newminted[python]{python}{} % usage: \begin{pythoncode} \end{pythoncode}
\newmintinline[pythoninline]{python}{} % usage: \pythoninline{inline code}




% I don't like slanted fonts in the exercises
\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{exercise}{Ex}[section]
\newtheorem{truefalse}[exercise]{TF}
\newtheorem{extra}[exercise]{Th}
%\numberwithin{equation}{section}



\usepackage{chngcntr}
\counterwithin{figure}{section}
\counterwithin*{sidenote}{section}


\newskip\tufteskipamount
\tufteskipamount=.5\baselineskip plus 0.5ex minus 0.2ex

\newcommand{\tuftebreak}{\par\ifdim\lastskip<\tufteskipamount
  \removelastskip\penalty-100\tufteskip\fi}

\newcommand{\tufteskip}{\vspace\tufteskipamount}

\makeatletter
\def\tuftebreak{%
  \if@nobreak\else
    \par
    \ifdim\lastskip<\tufteskipamount
      \removelastskip \penalty -100
      \tufteskip
    \fi
  \fi
}
\makeatother

\newcommand{\newthought}[1]{
\tuftebreak
\noindent\textsc{#1}}



\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\DeclareMathOperator*{\argmin}{arg\,min}

\newcommand{\abs}[1]{\left\vert#1\right\vert}
\newcommand{\Bern}[1]{\mathrm{Bern}(#1)}
\newcommand{\Bin}[1]{\mathrm{Bin}(#1)}
\newcommand{\Exp}[1]{\mathrm{Exp}(#1)}
\renewcommand{\Gamma}[1]{\mathrm{Gamma}(#1)}
\newcommand{\Norm}[1]{\mathrm{Norm}(#1)}
\newcommand{\Pois}[1]{\mathrm{Pois}(#1)}
\newcommand{\Unif}[1]{\mathrm{Unif}#1}
\newcommand{\given}{\,\middle|\,}
\renewcommand{\P}[1]{\,\mathsf{P}\left\{#1\right\}}
\newcommand{\PP}[2]{\,\mathsf{P}_{#1}\left\{#2\right\}}
\newcommand{\E}[1]{\,\mathsf{E}\left[#1\right]}
\newcommand{\V}[1]{\,\mathsf{V}\left[#1\right]}
\renewcommand{\d}[1]{\,\textrm{d}#1}
\newcommand{\1}[1]{\,\mathbb{1}_{#1}} % indicator
\newcommand{\supp}[1]{\mathrm{supp}\left(#1\right)}

\renewcommand{\TH}{\mathrm{TH}} % indicator


\newcommand{\QQ}{Q} % queue length
\renewcommand{\L}{L} % number in system
\newcommand{\J}{J} % sojourn time
\newcommand{\U}{U} % busy time
\newcommand{\W}{W} % waiting time (in queue)
\newcommand{\Ls}{L_s} % number at server
\newcommand{\IP}{P}
\newcommand{\IL}{I}

\newcommand{\recall}[1]{\emph{#1}\index{#1}}
